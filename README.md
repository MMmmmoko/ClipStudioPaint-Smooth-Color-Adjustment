# CSP流畅调色 ClipStudioPaint-Smooth-Color-Adjustment
使用前请务必详细阅读此Readme文件！
Please read this Readme file carefully before use!


我通过对CSP程序的直接修改，以及CSP插件的开发，解决了当前CSP在调色、模糊功能上的预览不实时的问题。同时也让缩时摄影的导出能自定义视频大小与时长。

由于我是在MacOS上进行开发的，所以这个库内容是不能在Windows系统中使用的，并且由于我是对3.2.3版本进行直接的修改，所以实际上是只能在M芯片（使用arm64指令集的芯片）的Mac电脑的3.2.3版本CSP上使用。。

对于windows版本，应该是得等我以后购置windows电脑后才开始考虑开发（什么基于自己需要的软件开发者啊）。希望那之前CSP已经自己识趣地把这些基础问题给优化了。

这个库会在CSP官方修复基础体验问题后删除，请大家支持正版。

## 内容与使用限制

《MacOS》文件夹中的内容是对ClipStudioPaint 3.2.3程序进行的修改，修改的内容有：包括插件功能在内的软件功能破解，对常用色调调整及其调整图层的实时预览（色相饱和度明度、色彩平衡、曲线），缩时摄影自定义视频大小与时长，应用后期调色而无需合并图层。
只能在使用arm指令集芯片的mac电脑上使用（如m芯片），并且只能用于3.2.3版本。

《Plugin》文件夹的内容是使用ClipStudioPaint的官方插件SDK所开发的两个模糊插件（高斯模糊、动态模糊），可以在支持插件功能的mac版CSP中使用（没有3.2.3的版本限制）。

## 安装方法

对于《Plugin》文件夹中的.cpm文件，请保证你的CSP可以使用插件功能。打开访达，进入“文稿”文件夹，里面有个名为CELSYS的快捷方式，进入上述CELSYS文件夹后再进入其中的CLIPStudioModule/Plugin/PAINT文件夹，将.cpm文件放在这里面。然后启动CPS，如果成功了，在“滤镜”菜单下能找到名为“流畅调色”的滤镜组，其中便有我提供的模糊滤镜。

《MacOS》中的内容只能在m芯片（或者其他arm指令集的芯片）的Mac电脑上使用，且只能用于3.2.3版本。
从CSP官方下载并安装CSP的3.2.3版本，查看ClipStudioPaint的程序包内容，找到其中的MacOS文件夹，将我提供的MacOS文件里的所有内容放入其中。然后你就可以正常使用ClipStudioPaint并也能使用上述.cpm文件了。

## 使用方法

调色功能按以往的方式直接使用即可。

缩时摄影在导出时会再弹出一个对话框让你填写视频大小和时长，这里你可以不再受选项的限制，自己按需导出，导出大于1280像素大小的视频也是可以的，因为本来就录制得很大，只是CSP不让你导出大的。

模糊功能在滤镜菜单里，进入滤镜菜单下的“流畅调色”子菜单可以找到。

批量应用后期功能是一个多图层调色功能，入口是“编辑”菜单中的“应用调整”。比如当画到一半的时候在顶层进行调色或者制作后期效果，但自己有分图层的习惯的话，这个功能能让你的中期调色和画面处理应用到其下的每个图层中，这样你能在保留分层的情况下继续作画。
如果要使用这个功能，自己的基础图层不能有如“正片叠底”这样的特殊模式的图层，必须都是普通的图层。需要创建一个名为“EFFECTS”的图层组，在这个组里创建图层进行画面处理（不要再建子图层组了）。在这个组里进行调色或者打光等操作，然后点击“应用调整”后，软件会将这个EFFECTS图层组复制到其下的每个 **未锁定图层** 的上方并执行“创建剪辑蒙版”“向下合并”的操作，执行完后，你所做的调整就直接应用在了所有图层中并且依然保留以前的分层状态。但其本质是一个带有一些条件判断的“自动动作”功能，所以是没办法一键撤销的，CSP没有PS那样的快照功能，所以使用前一定要保存文件！（这个功能没法保证图层组应用前后的画面完全一致，差异主要是半透明像素的叠加导致的）

## 注意事项

*色相饱和度明度的色调调整和新添加的滤镜不要在宽高超过16384像素的画布中使用。（metal图形接口的纹理大小限制纹理边长最大16384像素）

*由于CSP的狗屎底层，就算用GPU加速瞬间把画面渲染出来，也要花时间进行大量单线程CPU内存拷贝才能显示，所以在画布较大的时候也并非流畅，

*我不会经常浏览Github，如果有问题需要问我请不要在这里问，我看不到的。。。可以来b站私信问我或者邮件联系我https://space.bilibili.com/5808772

## 吐槽

逆向CSP的时候发现这个软件的开发人员几乎不知道多线程和GPU为何物，而且对图层直接调色时（直接编辑图层调色，不是新建调整图层）并不是只修改和预览画布显示的部分，而是在内存中将整个画布修改后再输出画面，这导致了就算我用GPU进行加速，在画布太大时也会因为CSP自身进行超大内存拷贝而限制预览流畅程度。甚至他们还专门写了计时功能，来让你的调色或者滤镜在鼠标停下一会后才开始处理画面，试图这样子来遮自己不能实时渲染的羞。 对于调色的优化，我做的大部分工作其实是找到并跳过CSP的计时逻辑，让CSP能在鼠标运动时就直接开始进行图像处理而不需要等鼠标停下， 就算这样就已经极大改善了使用体验了（对于尺寸上万的画布还是没救的）。
日本程序员刻板印象时刻加深中。这么基础的体验问题能拖到软件出4.0了还不解决是真的👍

想感受CSP狗屎优化可以下载CSP官方的插件SDK看看官方给的示例，示例的HSV（色相饱和度明度）滤镜插件的逻辑和CSP内部自带的HSV调色代码逻辑是几乎相同的。

如果CSP官方哪天突然一激灵改善了基础体验问题，请不要忘记我来过（

